name: Test Action

on:
  push:
    branches:
      - main

  workflow_dispatch:


jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        os: ["ubuntu", "macos"]
        python: ["3.10", "3.11", "3.12", "3.13"]
        pm: ["pip", "uv", "poetry", "pdm"]
    runs-on: ${{ matrix.os }}-latest
    steps:
      - name: Set Up uv
        uses: astral-sh/setup-uv@v4
        with:
          python-version: ${{ matrix.python }}

      - name: Install Package Manager
        if: ${{ matrix.pm != 'pip' && matrix.pm != 'uv' }}
        run: uv tool install ${{ matrix.pm }}

      - name: Install Reflex (pip)
        if: ${{ matrix.pm == 'pip' }}
        run: pip install reflex

      - name: Install Reflex (uv)
        if: ${{ matrix.pm == 'uv' }}
        run: uv init && uv add reflex

      - name: Install Reflex (PDM)
        if: ${{ matrix.pm == 'pdm' }}
        run: pdm init -n --python ${{ matrix.python }} && pdm add reflex

      - name: Install Reflex (Poetry)
        if: ${{ matrix.pm == 'poetry' }}
        shell: bash
        run: poetry init -n --python ^${{ matrix.python }} && poetry add reflex               
               
         - name: Initialize Reflex Project
        run: uv run reflex init --template blank || poetry run reflex init --template blank

      - name: Export Reflex Project
        uses: celsiusnarhwal/reflex-export@main
        with:
          args: --loglevel debug
